\input{preamble}

\begin{document}

\part{Warm-up}
\label{book-part-warmup}

\title{Rigidity}
\label{chapter-rigidity}

\maketitle

% \phantomsection
% \label{section-phantom}

\tableofcontents

We give an introduction to the phenomenon of rigidity of a nonlocal game. 

\section{What is rigidity?}
\label{section-rigidity}


\section{The Gowers Hatami theorem}
\label{section-gh}


\subsection{Approximate group representation}

We first make a small detour through the theory of group representations. For $d$-dimensional matrices  $A,B$ and $\sigma$ such that $\sigma$ is positive semidefinite, write 
$$\langle A,B\rangle_\sigma = \mathrm{Tr}(AB^* \sigma)\;,$$
where we use $B^*$ to denote the conjugate-transpose. Note that the matrix trace inner product is recovered for $\sigma = \Id$. If $\sigma$ is the totally mixed state, then we obtain a dimension-normalized variant of the trace inner product. We will also write $\|A\|_\sigma = \langle A,A\rangle_\sigma^{1/2}$. 

Given an arbitrary finite group $G$ (not necessarily abelian), a group representation of $G$ is a map $f:G \to U_d(\C)$, the group of $d\times d$ unitary matrices, such that $f$ is a homomorphism: for any $x,y\in G$, $f(x^{-1}y)=f(x)^* f(y)$, where we used $^*$ to denote the conjugate transpose (which, for unitary matrices, corresponds to taking the inverse). The following definition introduces a notion of \emph{approximate} group representation.  

\begin{definition}\label{def:approx-rep}
Given a finite group $G$, an integer $d\geq 1$, $\eps\geq 0$, and a $d$-dimensional positive semidefinite matrix $\sigma$ with trace $1$, an $(\eps,\sigma)$-representation of $G$ is a function $f: G \to U_d(\C)$, the unitary group of $d\times d$ matrices, such that 
\begin{equation}\label{eq:gh-condition}
\Es{x,y\in G} \,\Re\big(\big\langle f(x)^*f(y) ,f(x^{-1}y) \big\rangle_\sigma\big) \,\geq\, 1-\eps\;,
\end{equation} 
where the expectation is taken under the uniform distribution over $G$.
\end{definition}

Note that the condition~\eqref{eq:gh-condition} is equivalent to 
\begin{equation}\label{eq:gh-condition-2}
\Es{x,y\in G} \, \big\| f(x^{-1}y) - f(x)^*f(y) \big\|_\sigma^2 \,\leq\, 2\eps\;.
\end{equation}
Taking $\eps=0$ and $\sigma$ any invertible positive definite matrix, we see that the case $\eps=0$ corresponds to an \emph{exact} representation of $G$. 

\begin{example}\label{ex:wh-1}
Consider the Weyl-Heisenberg group $\mP$, which is the group generated by the Pauli $\sigma_X$ and $\sigma_Z$ matrices. It is not hard to verify that this group has $8$ elements, which can be decomposed as $(-1)^c \sigma_X^a \sigma_Z^b$ for $a,b,c\in\{0,1\}$. 
A qubit $(X,Z)$ according to our first definition (Definition~\ref{def:qubit-take1}) can be used to specify a $(0,\sigma)$ representation of $\mP$ for \emph{any} $\sigma$ as follows:
\begin{equation}\label{eq:def-rep-pauli}
 f\big((-1)^c \sigma_X^a \sigma_Z^b\big) \,=\, (-1)^c X^a Z^b\;,
\end{equation}
for all $a,b,c\in\{0,1\}$. It is immediate to verify that for all $(x,y)\in \mP$ we have $f(x)^*f(y)=f(x^{-1}y)$ and so~\eqref{eq:gh-condition} holds with $\eps=0$ for any $\sigma$.
\end{example}

The example makes explicit the connection between our notion of qubit with group representation theory. In this lecture we will leverage the connection to make use of powerful theorems from representation theory towards the analysis of an $n$-qubit test. As a warm-up, 
the following simple and recommended exercise asks you to generalize the example to the case of a single $\eps$-approximate qubit. 

\begin{exercise}\label{ex:wh-2}
Let $(\ket{\psi},X,Z)$ be a qubit such that $\ket{\psi}\in \mH$. Define $f:\mP \mapsto U(\mH)$ as in~\eqref{eq:def-rep-pauli}. Show that $f$ is an $(0,\sigma)$-representation of $\mP$ for $\sigma = \proj{{\psi}}$. Now suppose that $(\ket{\psi},X,Z)$ is only an $\eps$-approximate qubit in the sense of Exercise~\ref{ex:approx-qubit}. Show that $f$ is an $(O(\sqrt{\eps}),\sigma)$-representation of $\mP$. 
\end{exercise}

\begin{remark}
The condition \eqref{eq:gh-condition} in Definition~\ref{def:approx-rep} is very closely related to Gowers' $U^2$ norm
$$\|f\|_{U^2}^4 \,=\, \Es{xy^{-1}=zw^{-1}}\, \big\langle f(x)f(y)^* ,f(z)f(w)^* \big\rangle_\sigma.$$
While a large Gowers norm implies closeness to an affine function, we are interested in testing homomorphisms, and the condition \eqref{eq:gh-condition} will arise naturally from our calculations in the next section. 
\end{remark}

\subsection{The Gowers-Hatami theorem}

There are many possible notions of approximate group representation. Traditionally the most frequently considered one replaces the norm in Definition~\ref{def:approx-rep} by the operator norm. An inconvenience of that variant is that in general approximate representations are not always close to exact representations (see, for example, the famous problem on ``approximately commuting'' versus ``nearly commuting'' operators). In contrast 
Gowers and Hatami~\cite{gowers2017inverse} showed that in the case of Definition~\ref{def:approx-rep}, approximate group representations can always be ``rounded'' to a nearby exact representation.\footnote{We are barely scratching the surface of a growing theory of ``stability'' for group homomorphisms; see e.g.~\cite{becker2020stability} for an introduction and discussion of related notions.} 
We state and prove a slightly more general, but quantitatively weaker, variant of the Gowers-Hatami result.

\begin{theorem}[Gowers-Hatami]\label{thm:gh}
Let $G$ be a finite group, $\eps\geq 0$, and $f:G\to U_d(\C)$ an $(\eps,\sigma)$-representation of $G$. Then there exists a $d'\geq d$, an isometry $V:\C^d\to \C^{d'}$, and a representation $g:G\to U_{d'}(\C)$ such that 
$$\Es{x\in G}\, \big\| f(x) - V^*g(x)V \big\|_\sigma^2\, \leq\, 2\,\eps.$$ 
\end{theorem}

Gowers and Hatami limit themselves to the case of $\sigma = d^{-1}I_d$, which corresponds to the dimension-normalized Frobenius norm. In this scenario they in addition obtain a tight control of the dimension $d'$, and show that one can always take $d'\ = (1+O(\eps))d$ in the theorem. We will see a much shorter proof than theirs (the proof is implicit in their argument) that does not seem to allow to recover this estimate. The extension to general $\sigma$, however, will be necessary for our purposes.

Note that  Theorem \ref{thm:gh} does not in general hold  with $d'=d$. The reason is that it is possible for $G$ to have an approximate representation in some dimension $d$, but no exact representation of the same dimension: to obtain an example of this, take any group $G$ that has all non-trivial irreducible representations of large enough dimension, and create an approximate representation in e.g. dimension one less by ``cutting off'' one row and column from an exact representation. For sufficiently ``smooth'' $\sigma$ (no disproportionately large singular values) the dimension normalization induced by the norm $\|\cdot\|_\sigma$ will make this barely  noticeable, but it will be impossible to ``round'' the approximate representation obtained to an exact one without modifying the dimension. 

\begin{example}\label{ex:wh-3}
Continuing with Example~\ref{ex:wh-1} we consider the example of $G= \mP$. In Example~\ref{ex:wh-1} we observed that a qubit $(\ket{\psi},X,Z)$ can be used to specify a $(0,\sigma)$ representation $f$ of $\mP$ such that moreover $f(-1)=-\Id$. We now check that the converse holds: for any $(0,\sigma)$-representation of $\mP$ for invertible $\sigma$, if $X=f(\sigma_X)$ and $Z=f(\sigma_Z)$ then using~\eqref{eq:gh-condition-2}, taking $x=y=\sigma_X$ and $x=y=\sigma_Z$ it follows that $X^2 = Z^2=f(1)=\Id$, and taking $x=\sigma_X$ and $y=\sigma_Z$ we get that $XZ=f(\sigma_X \sigma_Z)$ while 
\[ZX=f(\sigma_Z\sigma_X)=f(-\sigma_X\sigma_Z)=f(-1)f(\sigma_X\sigma_Z)\;,\]
where the second equality uses that the Pauli anti-commute and the last equality again uses~\eqref{eq:gh-condition-2}. Thus if $f(-1)=-\Id$ then 
 $\{X,Z\}=0$, so the $(0,\sigma)$-representation $f$ specifies a qubit and in particular Lemma~\ref{lem:qubit-2-rigid} on the structure of a qubit applies. As a result, we have shown that there exists a single  representation of $\mP$ such that $f(-1)=-\Id$, and that it is given by the Pauli matrices in dimension $2$. 
\footnote{The condition $f(-1)=-\Id$ is necessary, as there are four $1$-dimensional representations of $\mP$: all combinations $f(\sigma_X)=\pm 1$ and $f(\sigma_Z)=\pm 1$. We have found the right number of irreps: $1\cdot 2^2 + 4\cdot 1 = 8 = |\mP|$.}
\end{example}

\begin{exercise}
Using Exercise~\ref{ex:wh-2} and Example~\ref{ex:wh-3}, show that Theorem~\ref{thm:gh} for the case where $G=\mP$ implies Exercise~\ref{ex:approx-qubit}. 
\end{exercise}

\begin{exercise}
Show Theorem~\ref{thm:gh} for the case where $G=\mP$. \emph{[Hint: Adapt the proof ``by calculation''
of Proposition~\ref{prop:explicit-iso} to take into account $\eps$-approximations.]}
\end{exercise}

The main ingredient for the proof of Theorem~\ref{thm:gh} is an appropriate notion of Fourier transform over non-abelian groups. Given an irreducible representation $\rho: G \to U_{d_\rho}(\C)$, define 
\begin{equation}\label{eq:fourier}
 \hat{f}(\rho) \,=\, \Es{x\in G} \,f(x) \otimes \overline{\rho(x)}.
\end{equation}
In case $G$ is abelian, we always have $d_\rho=1$, the tensor product is a product, and \eqref{eq:fourier} reduces to the usual definition of Fourier coefficient. The only properties we will need of irreducible representations is that they satisfy the relation
\begin{equation}\label{eq:ortho}
\sum_\rho \,d_\rho\,\mathrm{Tr}(\rho(x)) \,=\, |G|\delta_{xe}\;,
\end{equation}
for any $x\in G$. Note that plugging in $x=e$ (the identity element in $G$) yields $\sum_\rho d_\rho^2= |G|$. 

\begin{proof}[Proof of Theorem \ref{thm:gh}]
Our first step is to define an isometry $V:\C^d \to \C^d \otimes (\oplus_\rho \C^{d_\rho} \otimes \C^{d_\rho})$ by
$$ V :\;u \in \C^d \,\mapsto\, \bigoplus_\rho \,d_\rho^{1/2} \sum_{i=1}^{d_\rho} \,\big(\hat{f}(\rho) (u\otimes e_i)\big) \otimes e_i,$$
where the direct sum ranges over all irreducible representations $\rho$ of $G$ and $\{e_i\}$ is the canonical basis.\footnote{Observe that this expression directly generalizes~\eqref{eq:explicit-isometry}.}
Note what $V$ does: it ``embeds'' any vector $u\in \C^d$ into a direct sum, over irreducible representations $\rho$, of a $d$-dimensional vector of $d_\rho\times d_\rho$ matrices. Each (matrix) entry of this vector can be thought of as the Fourier coefficient of the corresponding entry of the vector $f(x)u$ associated with $\rho$. 
The fact that $V$ is an isometry follows from the appropriate extension of Parseval's formula:  
\begin{eqnarray*}
& V^* V &= \sum_\rho d_\rho \sum_i (I\otimes e_i^*) \hat{f}(\rho)^*\hat{f}(\rho) (I\otimes e_i)\\
&&= \Es{x,y}\,  f(x)^*f(y) \sum_\rho d_\rho \sum_i  (e_i^* \rho(x)^T \overline{\rho(y)} e_i)\\
&&= \sum_\rho \frac{d_\rho^2}{|G|}I = I,
\end{eqnarray*}
where for the second line we used the definition \eqref{eq:fourier} of $\hat{f}(\rho)$ and  for the third we used \eqref{eq:ortho} and the fact that $f$ takes values in the unitary group.

Next define
$$g(x) = \bigoplus_\rho \,\big(I_d \otimes I_{d_\rho} \otimes \rho(x)\big), $$
a direct sum over all irreducible representations of $G$ (hence itself a representation). Lets' first compute the ``pull-back'' of $g$ by $V$: following a similar calculation as above, for any $x\in G$, 
\begin{eqnarray*}
& V^*g(x) V  &=  \sum_{\rho}  d_\rho \sum_{i,j} (I\otimes e_i^*)\hat{f}(\rho)^* \hat{f}(\rho)(I\otimes e_j) \otimes e_i^* \rho(x) e_j ) \\
&& =  \Es{z,y}\,  f(z)^*f(y)  \sum_{\rho}  d_\rho \sum_{i,j} (e_i^* \rho(z)^T \overline{\rho(y)} e_j) \big( e_i^* \rho(x) e_j \big) \\
&& =  \Es{z,y}\,  f(z)^*f(y)  \sum_{\rho}  d_\rho \mathrm{Tr}\big( \rho(z)^T \overline{\rho(y)}  {\rho(x)^T} \big) \\
&& =  \Es{z,y}\,  f(z)^*f(y)  \sum_{\rho}  d_\rho \mathrm{Tr}\big( \rho(z^{-1}y x^{-1}) \big) \\
&& =  \Es{z}\,  f(z)^*f(zx) , 
\end{eqnarray*}
where the last equality uses \eqref{eq:ortho}.
It then follows that 
\begin{eqnarray*}
&\Es{x}\, \big\langle f(x), V^*g(x) V \big\rangle_\sigma &=  \Es{x,z} \mathrm{Tr}\big( f(x) f(zx)^* f(z)\sigma\big).
\end{eqnarray*}  
This relates correlation of $f$ with $V^*gV$ to the quality of $f$ as an approximate representation and proves the theorem. 
\end{proof}


\section{Rigidity for the Magic Square game}
\label{section-msrigid}










\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}